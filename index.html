<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Exile Manager</title>
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/worldMap.css">
    <link rel="stylesheet" href="css/exileScreen.css">
    <link rel="stylesheet" href="css/inventory.css">
    <link rel="stylesheet" href="css/mainUI.css">
</head>


<body>
    <!-- Resource Bar (spans right panel width at bottom) -->
    <div class="resource-bar">
        <div class="resources-left">
            <div class="resource-item">
                <span class="resource-label">Gold:</span>
                <span class="resource-value" id="gold">0</span>
            </div>
            <div class="resource-item">
                <span class="currency-icon chaos-icon">‚óä</span>
                <span class="resource-value" id="chaos-orbs">0</span>
            </div>
            <div class="resource-item">
                <span class="currency-icon exalt-icon">‚¨ü</span>
                <span class="resource-value" id="exalted-orbs">0</span>
            </div>
        </div>

        <div class="turn-and-button">
            <div class="resource-item">
                <span class="resource-label">Turn:</span>
                <span class="resource-value" id="current-turn">1</span>
            </div>
            <!-- End Turn Button -->
            <button class="end-turn-btn" id="end-turn-btn" onclick="exileRowManager.handleEndTurn()">
                End Turn (Enter)
            </button>
        </div>
    </div>

    <!-- Main Container -->
    <div class="main-container">
        <!-- Left Panel - Exiles -->
        <div class="exiles-panel">
            <!-- Exile Row 1 -->
            <div class="exile-row empty" data-exile-id="1">
                <div class="exile-status">
                    <div class="exile-name">Empty Slot</div>
                    <div class="exile-vitals">
                        <span>HP: --</span>
                        <span>Morale: --</span>
                    </div>
                </div>
                <div class="exile-main-area">
                    <div class="idle-message">No exile assigned</div>
                </div>
                <div class="exile-actions">
                    <!-- Action buttons will go here -->
                </div>
            </div>

            <!-- Exile Row 2 -->
            <div class="exile-row empty" data-exile-id="2">
                <div class="exile-status">
                    <div class="exile-name">Empty Slot</div>
                    <div class="exile-vitals">
                        <span>HP: --</span>
                        <span>Morale: --</span>
                    </div>
                </div>
                <div class="exile-main-area">
                    <div class="idle-message">No exile assigned</div>
                </div>
                <div class="exile-actions">
                    <!-- Action buttons will go here -->
                </div>
            </div>

            <!-- Exile Row 3 -->
            <div class="exile-row empty" data-exile-id="3">
                <div class="exile-status">
                    <div class="exile-name">Empty Slot</div>
                    <div class="exile-vitals">
                        <span>HP: --</span>
                        <span>Morale: --</span>
                    </div>
                </div>
                <div class="exile-main-area">
                    <div class="idle-message">No exile assigned</div>
                </div>
                <div class="exile-actions">
                    <!-- Action buttons will go here -->
                </div>
            </div>

            <!-- Exile Row 4 -->
            <div class="exile-row empty" data-exile-id="4">
                <div class="exile-status">
                    <div class="exile-name">Empty Slot</div>
                    <div class="exile-vitals">
                        <span>HP: --</span>
                        <span>Morale: --</span>
                    </div>
                </div>
                <div class="exile-main-area">
                    <div class="idle-message">No exile assigned</div>
                </div>
                <div class="exile-actions">
                    <!-- Action buttons will go here -->
                </div>
            </div>

            <!-- Exile Row 5 -->
            <div class="exile-row empty" data-exile-id="5">
                <div class="exile-status">
                    <div class="exile-name">Empty Slot</div>
                    <div class="exile-vitals">
                        <span>HP: --</span>
                        <span>Morale: --</span>
                    </div>
                </div>
                <div class="exile-main-area">
                    <div class="idle-message">No exile assigned</div>
                </div>
                <div class="exile-actions">
                    <!-- Action buttons will go here -->
                </div>
            </div>

            <!-- Exile Row 6 -->
            <div class="exile-row empty" data-exile-id="6">
                <div class="exile-status">
                    <div class="exile-name">Empty Slot</div>
                    <div class="exile-vitals">
                        <span>HP: --</span>
                        <span>Morale: --</span>
                    </div>
                </div>
                <div class="exile-main-area">
                    <div class="idle-message">No exile assigned</div>
                </div>
                <div class="exile-actions">
                    <!-- Action buttons will go here -->
                </div>
            </div>
        </div>

        <!-- Right Panel -->
        <div class="right-panel">
            <!-- Dynamic Display Area -->
            <div class="dynamic-display" id="dynamic-display">
                <div class="dynamic-tabs">
                    <button class="dynamic-tab active" data-tab="overview" title="Overview">üè†</button>
                    <button class="dynamic-tab" data-tab="world" title="World Map">üó∫Ô∏è</button>
                    <button class="dynamic-tab" data-tab="exile" title="Exile Details">üë§</button>
                    <button class="dynamic-tab" data-tab="equipment" title="Equipment">‚öîÔ∏è</button>
                    <button class="dynamic-tab" data-tab="passives" title="Passives">‚ú®</button>
                    <button class="dynamic-tab" data-tab="log" title="Activity Log">üìú</button>
                </div>

                <!-- Equipment Tab -->
                <div class="dynamic-content-area" id="tab-equipment">
                    <h2>Equipment</h2>
                    <p>No exile selected</p>
                </div>

                <!-- Passives Tab -->
                <div class="dynamic-content-area" id="tab-passives">
                    <h2>Passives</h2>
                    <p>No exile selected</p>
                </div>

                <!-- Overview Tab -->
                <div class="dynamic-content-area active" id="tab-overview">
                    <h2>Guild Overview</h2>
                    <p>Select an exile to see details</p>
                </div>

                <!-- Exile Details Tab -->
                <div class="dynamic-content-area" id="tab-exile">
                    <h2>Exile Details</h2>
                    <p>No exile selected</p>
                </div>

                <!-- World Map Tab -->
                <div class="dynamic-content-area" id="tab-world">
                    <h2>World Map</h2>
                    <p>Map content will go here</p>
                </div>

                <!-- Log Tab -->
                <div class="dynamic-content-area" id="tab-log">
                    <div id="log"></div>
                </div>
            </div>

            <!-- Inventory Panel (separate from dynamic display) -->
            <div id="inventory-panel" class="panel">
                <!-- Vertical tabs on the left -->
                <div class="inventory-tabs">
                    <button class="tab-button active" data-tab="tab1">1</button>
                    <button class="tab-button" data-tab="tab2">2</button>
                    <button class="tab-button" data-tab="tab3">3</button>
                    <button class="tab-button" data-tab="tab4">4</button>
                </div>

                <!-- Main inventory container -->
                <div class="inventory-container">
                    <!-- Left side: Grid -->
                    <div class="inventory-grid-wrapper">
                        <div id="inventory-grid">
                            <!-- Grid cells will be generated here -->
                        </div>

                        <!-- Sell controls -->
                        <div class="inventory-controls">
                            <button onclick="inventoryGridManager.sellAllByRarity('Common')">Sell All Common</button>
                            <button onclick="inventoryGridManager.sellAllByRarity('Magic')">Sell All Magic</button>
                            <button onclick="inventoryGridManager.sellAllByRarity('Rare')">Sell All Rare</button>
                        </div>
                    </div>

                    <!-- Right side: Item details -->
                    <div class="item-detail-panel">
                        <div id="item-detail-content">
                            <p class="no-item-selected">Select an item to view details</p>
                        </div>

                        <!-- Item actions -->
                        <div id="item-actions" style="display: none;">
                            <button id="lock-item-button"
                                onclick="inventoryGridManager.toggleItemLock(inventoryGridManager.selectedItem)">
                                üîí Lock Item
                            </button>
                            <button id="sell-item-button"
                                onclick="inventoryGridManager.sellItem(inventoryGridManager.selectedItem)">
                                üí∞ Sell Item
                            </button>
                            <button id="craft-item-button" onclick="game.craftItem(inventoryGridManager.selectedItem)">
                                üî® Craft Item
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal Support -->
        <!-- Passive Selection Modal -->
        <div id="passive-selection-modal" class="modal-overlay" style="display: none;"
            onclick="passiveSystem.handlePassiveModalClick(event)">
            <div class="modal-content passive-modal">
                <h2 id="passive-modal-title">Choose Your Passive</h2>

                <div class="passive-choices">
                    <!-- Choice 1 -->
                    <div class="passive-choice" id="passive-choice-1" onclick="passiveSystem.selectChoice(1)">
                        <div class="passive-choice-header">
                            <span class="passive-choice-name">Loading...</span>
                            <span class="passive-choice-tier">normal</span>
                        </div>
                        <p class="passive-choice-description">Loading...</p>
                    </div>

                    <!-- Choice 2 -->
                    <div class="passive-choice" id="passive-choice-2" onclick="passiveSystem.selectChoice(2)">
                        <div class="passive-choice-header">
                            <span class="passive-choice-name">Loading...</span>
                            <span class="passive-choice-tier">normal</span>
                        </div>
                        <p class="passive-choice-description">Loading...</p>
                    </div>
                </div>

                <div class="passive-modal-actions">
                    <button id="confirm-passive-btn" onclick="passiveSystem.confirmPassive()" disabled>Confirm
                        Selection</button>
                    <button id="reroll-passive-btn" onclick="passiveSystem.rerollPassiveChoices()">Reroll (X gold)</button>
                    <button onclick="passiveSystem.closePassiveSelection()">Cancel</button>
                </div>
            </div>
        </div>

        <!-- END OF Modal Support -->

        <!-- SCRIPTS MUST GO LAST html elements need to be loaded for these to interact with -->
        <script src="js/gameState.js"></script>
        <script src="js/data/passives.js"></script>
        <script src="js/nameGenerator.js"></script>
        <script src="js/systems/exileFactory.js"></script>

        <!-- World system data files -->
        <script src="js/data/missionTypes.js"></script>
        <script src="js/data/areas.js"></script>

        <!-- World system logic -->
        <script src="js/systems/worldSystem.js"></script>

        <script type="module">
            // Import data systems
            import { monsterDB } from './js/data/monsters.js';
            import { bossDB } from './js/data/bosses.js';
            import { itemBases } from './js/data/items.js';  // NEW: Import item data

            // Import existing item systems
            import { itemDB, Equipment, Weapon, Armor, Jewelry, Ring, Amulet, Belt } from './js/systems/itemSystem.js';  // UPDATED: Import all classes
            import { statDB } from './js/systems/statSystem.js';
            import { rarityDB } from './js/systems/raritySystem.js';

            // Import new game systems
            import { exileSystem } from './js/systems/exileSystem.js';
            import { moraleSystem } from './js/systems/moraleSystem.js';
            import { combatSystem } from './js/systems/combatSystem.js';
            import { missionSystem } from './js/systems/missionSystem.js';
            import { inventorySystem } from './js/systems/inventorySystem.js';
            import { worldMapSystem } from './js/systems/worldMapSystem.js';
            import { monsterSpawnSystem } from './js/systems/monsterSpawnSystem.js';
            import { turnBasedCombat, MissionState, Encounter } from './js/systems/encounterSystem.js';
            import { missionGeneration } from './js/systems/missionGenerationSystem.js';
            import { passiveSystem } from './js/systems/passiveSystem.js';
            import { uiSystem } from './js/systems/uiSystem.js';

            // Make them globally available during transition
            window.monsterDB = monsterDB;
            window.bossDB = bossDB;
            window.itemBases = itemBases;  
            window.itemDB = itemDB;
            window.Equipment = Equipment;  
            window.Weapon = Weapon;
            window.Armor = Armor;
            window.Jewelry = Jewelry;
            window.Ring = Ring;
            window.Amulet = Amulet;
            window.Belt = Belt;
            window.statDB = statDB;
            window.rarityDB = rarityDB;
            window.exileSystem = exileSystem;
            window.moraleSystem = moraleSystem;
            window.combatSystem = combatSystem;
            window.missionSystem = missionSystem;
            window.inventorySystem = inventorySystem;
            window.worldMapSystem = worldMapSystem;
            window.monsterSpawnSystem = monsterSpawnSystem;
            window.turnBasedCombat = turnBasedCombat;
            window.MissionState = MissionState;
            window.Encounter = Encounter;
            window.missionGeneration = missionGeneration;
            window.passiveSystem = passiveSystem;
            window.uiSystem = uiSystem;

            // Log that systems are loaded
            console.log("Game systems loaded:", {
                monsters: !!window.monsterDB,
                bosses: !!window.bossDB,
                itemBases: !!window.itemBases,  
                itemDB: !!window.itemDB,
                items: {  
                    database: !!window.itemDB,
                    bases: !!window.itemBases,
                    Equipment: !!window.Equipment,
                    Weapon: !!window.Weapon,
                    Armor: !!window.Armor
                },
                monsterSpawn: !!window.monsterSpawnSystem,
                turnBasedCombat: !!window.turnBasedCombat,
                exile: !!window.exileSystem,
                combat: !!window.combatSystem,
                mission: !!window.missionSystem,
                passive: !!window.passiveSystem,
                ui: !!window.uiSystem
            });
        </script>

        <script src="js/game.js"></script>

        <!-- UI Managers -->
        <script src="js/ui/exileRowManager.js"></script>
        <script src="js/ui/dynamicDisplayManager.js"></script>
        <script src="js/ui/inventoryGridManager.js"></script>


        <!-- This goes Last -->
        <script src="js/main.js"></script>

</body>

</html>